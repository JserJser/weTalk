{"version":3,"sources":["webpack:///./src/views/WorldRoom.vue?4de5","webpack:///./src/views/WorldRoom.vue","webpack:///./src/views/WorldRoom.vue?d181","webpack:///./src/views/WorldRoom.vue?6e6a","webpack:///./src/assets/img/male.svg","webpack:///./src/assets/img/female.svg","webpack:///./src/views/WorldRoom.vue?ffe8"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","z-depth","color","slot","icon","on","click","toback","value","_v","content","number","circle","_l","item","index","key","type","user","id","src","avatar","sex","__webpack_require__","alt","_s","name","time","cover","placement","button","$event","backMess","directives","rawName","expression","rows","domProps","keyup","indexOf","_k","keyCode","toSend","input","target","composing","sendText","disabled","staticRenderFns","WorldRoomvue_type_script_lang_ts_WorldRoom","_Vue","WorldRoom","_this","Object","classCallCheck","$store","getters","msgList","inherits","createClass","_this2","ws","WebSocket","window","location","host","onopen","e","creatSending","onmessage","resData","JSON","parse","data","console","log","isRemove","commit","message","$nextTick","msgEl","document","querySelector","scrollIntoView","err","error","backoutMess","model_message","send","stringify","Date","toISOString","replace","$router","push","createWebsocket","close","vue_property_decorator","tslib_es6","computed","methods","objectSpread","vuex_esm","WorldRoomvue_type_script_lang_ts_","views_WorldRoomvue_type_script_lang_ts_","component","componentNormalizer","__webpack_exports__","module","exports","p","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_WorldRoom_vue_vue_type_style_index_0_lang_less___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_WorldRoom_vue_vue_type_style_index_0_lang_less___WEBPACK_IMPORTED_MODULE_0___default","n"],"mappings":"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","file":"js/chunk-fa20223c.6ee9760d.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"talk-room\"},[_c('mu-paper',{staticClass:\"demo-list-wrap\",attrs:{\"z-depth\":0}},[_c('mu-appbar',{attrs:{\"z-depth\":0,\"color\":\"cyan\"}},[_c('mu-button',{attrs:{\"slot\":\"left\",\"icon\":\"\"},on:{\"click\":_vm.toback},slot:\"left\"},[_c('mu-icon',{attrs:{\"value\":\"arrow_back\"}})],1),_vm._v(\"\\n      世界聊天室\\n      \"),_c('mu-badge',{staticClass:\"barBadge\",attrs:{\"slot\":\"right\",\"content\":_vm.number,\"circle\":\"\",\"color\":\"secondary\"},slot:\"right\"},[_c('mu-icon',{attrs:{\"value\":\"person\"}})],1)],1),_c('div',{staticClass:\"mess-box\"},[_c('div',{staticClass:\"mess-list\"},_vm._l((_vm.msgList),function(item,index){return _c('div',{key:index,staticClass:\"list-item\"},[(item.type==1&&item.user.id!=_vm.user.id)?_c('div',{staticClass:\"mess-item\"},[_c('mu-avatar',[_c('img',{attrs:{\"src\":item.user.avatar}}),_c('img',{staticClass:\"icon-sex\",attrs:{\"src\":item.user.sex=='男'?require('@/assets/img/male.svg'):require('@/assets/img/female.svg'),\"alt\":\"\"}})]),_c('div',{staticClass:\"mess-item-right\"},[_c('span',[_vm._v(_vm._s(item.user.name))]),_c('p',{staticClass:\"mess-item-content\"},[_vm._v(_vm._s(item.content))]),_c('p',{staticClass:\"mess-item-time\"},[_vm._v(_vm._s(item.time))])])],1):(item.type==1&&item.user.id==_vm.user.id)?_c('div',{staticClass:\"mess-item-me\"},[_c('mu-avatar',[_c('img',{attrs:{\"src\":_vm.user.avatar}}),_c('img',{staticClass:\"icon-sex\",attrs:{\"src\":_vm.user.sex=='男'?require('@/assets/img/male.svg'):require('@/assets/img/female.svg'),\"alt\":\"\"}})]),_c('div',{staticClass:\"mess-item-right\"},[_c('span',[_vm._v(_vm._s(_vm.user.name))]),_c('mu-menu',{attrs:{\"cover\":\"\",\"placement\":\"bottom-end\"}},[_c('p',{staticClass:\"mess-item-content\"},[_vm._v(_vm._s(item.content))]),_c('mu-list',{attrs:{\"slot\":\"content\"},slot:\"content\"},[_c('mu-list-item',{attrs:{\"button\":\"\"},on:{\"click\":function($event){return _vm.backMess(index)}}},[_c('mu-list-item-title',[_vm._v(\"撤销\")])],1)],1)],1),_c('p',{staticClass:\"mess-item-time\"},[_vm._v(_vm._s(item.time))])],1)],1):_c('div',{staticClass:\"mess-system\"},[_vm._v(\"\\n            \"+_vm._s(item.content)+\"\\n          \")])])}),0)])],1),_c('div',{staticClass:\"talk-bottom\"},[_c('div',{staticClass:\"talk-send\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.sendText),expression:\"sendText\"}],attrs:{\"rows\":\"1\",\"name\":\"text\"},domProps:{\"value\":(_vm.sendText)},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.toSend($event)},\"input\":function($event){if($event.target.composing){ return; }_vm.sendText=$event.target.value}}}),_c('mu-button',{attrs:{\"color\":\"primary\",\"disabled\":_vm.sendText==''?true:false},on:{\"click\":_vm.toSend}},[_vm._v(\"发送\")])],1)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Message from '../model/message'\nimport User from '../model/user'\nimport { Component, Vue } from 'vue-property-decorator'\nimport { mapState, mapMutations, mapGetters } from 'vuex'\n\n@Component({\n  computed: {\n    // ...mapGetters(['user', 'msgList'])  ??????\n  },\n  methods: {\n    ...mapMutations(['addMsg'])\n  }\n})\nexport default class WorldRoom extends Vue {\n  sendText: string = ''\n  number: string = '0' // ui组件要string型的\n  // mesgLists: Array<Object> = []\n  ws: any\n  private user: User = this.$store.getters.user\n  private msgList: Message[] = this.$store.getters.msgList\n  public createWebsocket () {\n    this.ws = new WebSocket('ws://' + window.location.host)\n    this.ws.onopen = (e: any) => {\n      // console.log('connection established')\n      this.creatSending(this.user.name + ' 进入聊天室', 0)\n    }\n    this.ws.onmessage = (e: any) => {\n      // console.log(e)\n      var resData = JSON.parse(e.data)\n      // console.log(message.user, this.user, message.user === this.user)\n      // this.mesgLists.push({ message })\n      console.log('resData', resData)\n      if (resData.isRemove) {\n        this.$store.commit('removeMsg', resData.message)\n      } else {\n        this.$store.commit('addMsg', resData.message)\n      }\n\n      if (resData.message.type === -1) {\n        this.number = (resData.number - 1) + ''\n      } else {\n        this.number = resData.number + ''\n      }\n      this.$nextTick(() => {\n        try {\n          const msgEl = document.querySelector('.mess-list .list-item:last-child')\n          if (msgEl) {\n            msgEl.scrollIntoView()\n          }\n        } catch (err) {\n          console.error(err)\n        }\n      })\n    }\n  }\n  backMess (index: number) {\n    this.backoutMess(this.msgList[index])\n  }\n  backoutMess (message: Message) {\n    console.log('Message', Message)\n    var data = {\n      message: message,\n      isRemove: true\n    }\n    this.ws.send(JSON.stringify(data))\n  }\n  creatSending (content: string, type: number) {\n    var time = new Date(+new Date() + 8 * 3600 * 1000).toISOString().replace(/T/g, ' ').replace(/\\.[\\d]{3}Z/, '')\n    var message = new Message(time, content, type, type === 1 ? this.user : null)\n    var data = {\n      message: message\n    }\n    this.ws.send(JSON.stringify(data))\n  }\n  toSend () {\n    if (this.sendText !== '') {\n      this.creatSending(this.sendText, 1)\n      this.sendText = ''\n    }\n  }\n  toback () {\n    this.$router.push('/')\n  }\n  created () {\n    this.createWebsocket()\n  }\n  beforeDestroy () {\n    this.creatSending(this.user.name + ' 退出聊天室', -1)\n    this.ws.close()\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WorldRoom.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WorldRoom.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./WorldRoom.vue?vue&type=template&id=46798b1e&\"\nimport script from \"./WorldRoom.vue?vue&type=script&lang=ts&\"\nexport * from \"./WorldRoom.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./WorldRoom.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/male.960485f7.svg\";","module.exports = __webpack_public_path__ + \"img/female.88866ba0.svg\";","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WorldRoom.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WorldRoom.vue?vue&type=style&index=0&lang=less&\""],"sourceRoot":""}