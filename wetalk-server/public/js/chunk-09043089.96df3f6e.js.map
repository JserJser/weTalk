{"version":3,"sources":["webpack:///./src/views/WorldRoom.vue?25dc","webpack:///./src/model/message.ts","webpack:///./src/views/WorldRoom.vue","webpack:///./src/views/WorldRoom.vue?d181","webpack:///./src/views/WorldRoom.vue?6e6a","webpack:///./src/assets/img/male.svg","webpack:///./node_modules/@babel/runtime-corejs2/helpers/esm/createClass.js","webpack:///./src/assets/img/female.svg","webpack:///./src/views/WorldRoom.vue?ffe8"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","z-depth","color","slot","icon","on","click","toback","value","_v","content","number","circle","_l","item","index","key","type","user","id","src","avatar","sex","__webpack_require__","alt","_s","name","time","directives","rawName","expression","rows","domProps","keyup","$event","indexOf","_k","keyCode","toSend","input","target","composing","sendText","disabled","staticRenderFns","message_Message","Message","Object","classCallCheck","model_message","WorldRoomvue_type_script_lang_ts_WorldRoom","_Vue","WorldRoom","_this","$store","getters","msgList","inherits","createClass","_this2","ws","WebSocket","onopen","e","creatSending","onmessage","resData","JSON","parse","data","commit","message","$nextTick","msgEl","document","querySelector","scrollIntoView","err","console","error","Date","toISOString","replace","send","stringify","$router","push","createWebsocket","close","vue_property_decorator","tslib_es6","computed","methods","objectSpread","vuex_esm","WorldRoomvue_type_script_lang_ts_","views_WorldRoomvue_type_script_lang_ts_","component","componentNormalizer","__webpack_exports__","module","exports","p","d","_createClass","_core_js_object_define_property__WEBPACK_IMPORTED_MODULE_0__","_core_js_object_define_property__WEBPACK_IMPORTED_MODULE_0___default","n","_defineProperties","props","i","length","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","prototype","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_WorldRoom_vue_vue_type_style_index_0_lang_less___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_css_loader_index_js_ref_10_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_WorldRoom_vue_vue_type_style_index_0_lang_less___WEBPACK_IMPORTED_MODULE_0___default"],"mappings":"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","file":"js/chunk-09043089.96df3f6e.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"talk-room\"},[_c('mu-paper',{staticClass:\"demo-list-wrap\",attrs:{\"z-depth\":0}},[_c('mu-appbar',{attrs:{\"z-depth\":0,\"color\":\"cyan\"}},[_c('mu-button',{attrs:{\"slot\":\"left\",\"icon\":\"\"},on:{\"click\":_vm.toback},slot:\"left\"},[_c('mu-icon',{attrs:{\"value\":\"arrow_back\"}})],1),_vm._v(\"\\n      世界聊天室\\n      \"),_c('mu-badge',{staticClass:\"barBadge\",attrs:{\"slot\":\"right\",\"content\":_vm.number,\"circle\":\"\",\"color\":\"secondary\"},slot:\"right\"},[_c('mu-icon',{attrs:{\"value\":\"person\"}})],1)],1),_c('div',{staticClass:\"mess-box\"},[_c('div',{staticClass:\"mess-list\"},_vm._l((_vm.msgList),function(item,index){return _c('div',{key:index,staticClass:\"list-item\"},[(item.type==1&&item.user.id!=_vm.user.id)?_c('div',{staticClass:\"mess-item\"},[_c('mu-avatar',[_c('img',{attrs:{\"src\":item.user.avatar}}),_c('img',{staticClass:\"icon-sex\",attrs:{\"src\":item.user.sex=='男'?require('@/assets/img/male.svg'):require('@/assets/img/female.svg'),\"alt\":\"\"}})]),_c('div',{staticClass:\"mess-item-right\"},[_c('span',[_vm._v(_vm._s(item.user.name))]),_c('p',{staticClass:\"mess-item-content\"},[_vm._v(_vm._s(item.content))]),_c('p',{staticClass:\"mess-item-time\"},[_vm._v(_vm._s(item.time))])])],1):(item.type==1&&item.user.id==_vm.user.id)?_c('div',{staticClass:\"mess-item-me\"},[_c('mu-avatar',[_c('img',{attrs:{\"src\":_vm.user.avatar}}),_c('img',{staticClass:\"icon-sex\",attrs:{\"src\":_vm.user.sex=='男'?require('@/assets/img/male.svg'):require('@/assets/img/female.svg'),\"alt\":\"\"}})]),_c('div',{staticClass:\"mess-item-right\"},[_c('span',[_vm._v(_vm._s(_vm.user.name))]),_c('p',{staticClass:\"mess-item-content\"},[_vm._v(_vm._s(item.content))]),_c('p',{staticClass:\"mess-item-time\"},[_vm._v(_vm._s(item.time))])])],1):_c('div',{staticClass:\"mess-system\"},[_vm._v(\"\\n            \"+_vm._s(item.content)+\"\\n          \")])])}),0)])],1),_c('div',{staticClass:\"talk-bottom\"},[_c('div',{staticClass:\"talk-send\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.sendText),expression:\"sendText\"}],attrs:{\"rows\":\"1\",\"name\":\"text\"},domProps:{\"value\":(_vm.sendText)},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.toSend($event)},\"input\":function($event){if($event.target.composing){ return; }_vm.sendText=$event.target.value}}}),_c('mu-button',{attrs:{\"color\":\"primary\",\"disabled\":_vm.sendText==''?true:false},on:{\"click\":_vm.toSend}},[_vm._v(\"发送\")])],1)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import User from './user'\r\n\r\nclass Message {\r\n  private time: string\r\n  public content: string = ''\r\n  private type: number //  0 为系统消息(加入聊天室) -1（退出聊天室） 1为用户消息\r\n  private user: User | null\r\n  constructor (time: string, content: string, type: number, user: User | null) {\r\n    this.time = time\r\n    this.content = content\r\n    this.type = type\r\n    this.user = user\r\n  }\r\n}\r\n\r\nexport default Message\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Message from '../model/message'\nimport User from '../model/user'\nimport { Component, Vue } from 'vue-property-decorator'\nimport { mapState, mapMutations, mapGetters } from 'vuex'\n\n@Component({\n  computed: {\n    // ...mapGetters(['user', 'msgList'])  ??????\n  },\n  methods: {\n    ...mapMutations(['addMsg'])\n  }\n})\nexport default class WorldRoom extends Vue {\n  sendText: string = ''\n  number: string = '0' // ui组件要string型的\n  // mesgLists: Array<Object> = []\n  ws: any\n  private user: User = this.$store.getters.user\n  private msgList: Message[] = this.$store.getters.msgList\n  public createWebsocket () {\n    this.ws = new WebSocket('ws://mccyu.com:9615')\n    this.ws.onopen = (e: any) => {\n      // console.log('connection established')\n      this.creatSending(this.user.name + ' 进入聊天室', 0)\n    }\n    this.ws.onmessage = (e: any) => {\n      // console.log(e)\n      var resData = JSON.parse(e.data)\n      // console.log(message.user, this.user, message.user === this.user)\n      // this.mesgLists.push({ message })\n      this.$store.commit('addMsg', resData.message)\n      if (resData.message.type === -1) {\n        this.number = (resData.number - 1) + ''\n      } else {\n        this.number = resData.number + ''\n      }\n      // console.log(this.msgList)\n      this.$nextTick(() => {\n        try {\n          const msgEl = document.querySelector('.mess-list .list-item:last-child')\n          if (msgEl) {\n            msgEl.scrollIntoView()\n          }\n        } catch (err) {\n          console.error(err)\n        }\n      })\n    }\n  }\n  creatSending (content: string, type: number) {\n    var time = new Date(+new Date() + 8 * 3600 * 1000).toISOString().replace(/T/g, ' ').replace(/\\.[\\d]{3}Z/, '')\n    var message = new Message(time, content, type, type === 1 ? this.user : null)\n    var data = {\n      message: message\n    }\n    this.ws.send(JSON.stringify(data))\n  }\n  toSend () {\n    if (this.sendText !== '') {\n      this.creatSending(this.sendText, 1)\n      this.sendText = ''\n    }\n  }\n  toback () {\n    this.$router.push('/')\n  }\n  created () {\n    this.createWebsocket()\n  }\n  beforeDestroy () {\n    this.creatSending(this.user.name + ' 退出聊天室', -1)\n    this.ws.close()\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WorldRoom.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WorldRoom.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./WorldRoom.vue?vue&type=template&id=29a09a86&\"\nimport script from \"./WorldRoom.vue?vue&type=script&lang=ts&\"\nexport * from \"./WorldRoom.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./WorldRoom.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/male.960485f7.svg\";","import _Object$defineProperty from \"../../core-js/object/define-property\";\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n\n    _Object$defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","module.exports = __webpack_public_path__ + \"img/female.88866ba0.svg\";","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WorldRoom.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WorldRoom.vue?vue&type=style&index=0&lang=less&\""],"sourceRoot":""}